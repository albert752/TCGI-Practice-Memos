# Practice 9 Memo of TCGI
## 0.5 MAC multicast addresses
After running on the server `ping -c1 224.0.0.1` we capture the traffic on
SimNet3. The results where the following:

1. We can only see one ICMP packet on the net. It is a echo ping request.
2. The TTL of this packet is 1 so it won't leave SimNet3.
3. The source and destination @IP in the IP header are:
	* src: 172.16.1.3
	* dst: 224.0.0.1
4. For the ethernet header:
	* src: Ethernet II, fe:fd:00:00:03:01
	* dst: IPv4mcast_01, 01:00:5e:00:00:01
5. We can see the direct mapping of the @IP on the @MAC. 
	* The first byte indicates multicast
	* The second and third are fixed and belog also to multicast
	* The fourth one begins with a 0 and if we add the 7 lsb of the second  byte
		of the IP results to all 0.
	* From the fifth to the seventh, they match the IP fields.

Now we are going to also listen on SimNet3 but ping to 232.0.0.1. These are the
results:

1. The @MAC of the frame are:
	* Src: fe:fd:00:00:03:01 (fe:fd:00:00:03:01)
	* Dst: IPv4mcast_01 (01:00:5e:00:00:01)
2. We can see that the destination @MAC is the same as before althow the @IP is
   	different. 
3. The sustem will resolve this ambiguity at the IP layer where it
   	will retrieve the full @IP.

After setting up the server to not ignore broadcast and multicas ICMP packate
we run the same test as in the fisrt exercice but now with `-c3`. These are the
results:

1. The pings are now fully working. But there is no reply messages on SimNet3.
   I supose that the server is answering itself the requests.
2. As mentioned before, no reply messages where seen.

Now we disable the same flag on R2 and re-run the ping:
1. Both the server and R2 are answering the ping.
2. Now we can see reply messages on SimNet3 generated by R2
3. Those messages are sent in  aunicast way. ARP gets triggered and also the
   @IP are the unicast ones
* Also mention that the ping app reprts duplicated packages.

## 0.6 Multicast transmission in a subnet
### 0.6.1 Multicast configuration
In order to retrieve information about the joined groups by the host, we can
explore the file `/proc/net/igmp`:
```
Idx     Device    : Count Querier       Group    Users Timer    Reporter
1       lo        :     1      V3
                                010000E0     1 0:00000000               0
5       eth1      :     1      V3
                                010000E0     1 0:00000000               0
```

If we reverse the @IP in hex `010000E0` and turn it into bynary, we'll see
224.0.0.1. The `netstat -gn`  command can also be used.

* `/proc/net/ip_mr_vif`: this file contains the interfaces that are involved in multicast operations in the multicast router, and some statistics of usage

* `/proc/net/ip_mr_cache`: this file shows the contents of the Multicast Forwarding Cache.

### 0.6.3 udp-sender
To set up the video server, we execute on the server machine:
```
udp-sender --file=./big_664.mpg --min-clients 1 --portbase 22345 
--nopointopoint --interface eth1 --ttl 1 --mcast-addr 232.43.211.234 
--mcast-all-addr 225.1.2.3

```

* `--file`: The realive path to the file.
* `--min-clients`: Automatically start as soon as a minimal number of clients have
           connected.
* `--portbase`: The app port starting point.
*  `--nopointopoint`: Don't use point-to-point, even if there is only one single
           receiver.
* `--mcast-all-addr`: Uses a non-standard multicast address for the control connection
           (which is used by the sender and receivers to "find" each other).
           This is not the address that is used to transfer the data.
* `--mcast-addr`: Uses the given address for multicasting the data. If not specified,
           the program will automatically derive a multicast address from its
           own IP (by keeping the last 27 bits of the IP and then prepending
           232).

The other parameters are self explanatory.

After running the command these are the results:
1. We can only see one UDP packet and two IGMPv3 packets.
2. In the UDP packet:
	* Internet Protocol Version 4, Src: 172.16.1.3, Dst: 225.1.2.3
	* TTL=1
3. The port numbers Src Port: 22346, Dst Port: 22345. It complies with the
   goven command.
4. The two IGMPv3 packets are the same (redundacy) and they are 0x22 type so
   Membership report. The @IP are Src: 172.16.1.3, Dst: 224.0.0.22. Due to the fact that
   we are using v3 of this protocol, all `Menbership Reports/Join group` are sent to this
   specific @IP with TTL=1 (as specified by the app) and payload the multicast 
   addr of the grup the host is willing to join.
* It is also worth mentioning that those IGMP mesages get no response because
	there is not a m/c capable router

Now if we check the other console:
```
Every 1.0s: cat /proc/net/igmp                          Thu May  9 13:15:37 2019

Idx     Device    : Count Querier       Group    Users Timer    Reporter
1       lo        :     1      V3
                                010000E0     1 0:00000000               0
5       eth1      :     2      V3
                                030201E1     1 0:00000000               0
                                010000E0     1 0:00000000               0

```

1. We can see that now the iface eth1 has another entry for another group. 
2. The new entry stands for the @IP 225.1.2.3 which is the specified @IP to
   send all the control data.

After closing the server:
1. We can see two unanswered `Memebership Report/leave group` containing the
   @IP of the previosly mentioned control group.
2. The added entry has now been removed.

### 0.6.4 upd-receiver


